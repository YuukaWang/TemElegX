\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{TemElegXv2.0}[2025/08/14 v2.0 an ēlēgit template for LaTeX]  


\RequirePackage[UTF8, fontset=none]{ctex}
\xeCJKsetup{AutoFallBack=true, space=auto}
\RequirePackage[no-math]{fontspec}
% \RequirePackage{mathspec}
\RequirePackage{ulem, circledsteps}
\RequirePackage{xcolor}
% \RequirePackage{bm}
\definecolor{tblue}{RGB}{91, 216, 250}
\definecolor{tpink}{RGB}{246, 169, 196}
%tpink tblue lime
%cyan magenta yellow
%violet brown teal
%orange gray purple
\newcommand{\bacolor}{\colorbox}
\newcommand{\tecolor}{\textcolor}

\newcommand{\Circ}[1]{\hspace{0.1em}\Circled{#1}\hspace{0.1em}}
\RequirePackage[thicklines]{cancel}
\RequirePackage{siunitx}
\sisetup{detect-all, separate-uncertainty=true}
\RequirePackage{enumitem}

\newcommand{\subsubsubsection}[1]{\paragraph{#1}\mbox{}\\ }
\setcounter{secnumdepth}{4} %how many sectioning levels to assign numbers to
\setcounter{tocdepth}{4} %how many sectioning levels to show in ToC

\newcommand{\n}{\par}
\renewcommand{\figurename}{\textbf{Fig.}}
\renewcommand{\tablename}{\textbf{Tab.}}
%\renewcommand{\underline}{\uline}


\RequirePackage{kvoptions}
\SetupKeyvalOptions{family=TemElegX, prefix=TemElegX@}
\DeclareBoolOption{geometry}
\DeclareBoolOption{fancy}
\DeclareBoolOption{font}
\DeclareBoolOption{graphicx}
\DeclareBoolOption{table}
\DeclareBoolOption{math}
\DeclareBoolOption{phys}
\DeclareBoolOption{chem}
\DeclareBoolOption{env}
\ProcessKeyvalOptions*

\ifTemElegX@geometry
  \RequirePackage{geometry}%
  \geometry{a4paper, 
    top=3.2cm,%
    inner=2.7cm,%
    outer=3.2cm,%
    bottom=3.1cm,%
  }%
  \raggedbottom%
  \linespread{1.3}%
\fi

\ifTemElegX@fancy
  \RequirePackage{fancyhdr}%
  \pagestyle{fancy}%
  %\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
  %\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}
  %\renewcommand{\subsectionmark}[1]{\markright{\thesubsection\ #1}}
  %\renewcommand{\subsectionmark}[1]{\markright{\thesubsection\ #1}}
  \fancyhf{}%
  % 设置页眉 (head)
  \setlength{\headheight}{15.4pt}% 页眉高度
  \fancyhead[RE]{\leftmark}% 在偶数页的右侧显示章名
  \fancyhead[LO]{\rightmark}% 在奇数页的左侧显示小节名
  % 设置页脚：在每页的右下脚以斜体显示书名
  \renewcommand{\headrulewidth}{0.6pt}% 页眉与正文之间的水平线粗细
  \renewcommand{\footrulewidth}{0pt}
  \pagestyle{fancy}% 选用 fancy style
  \fancyfoot[RO,LE]{\textit{Typesetting with \LaTeX}}% 在奇数页的右侧，偶数页的左侧显示书名
  \fancyfoot[LO,RE]{~\thepage~}% 在奇数页的左侧，偶数页的右侧显示页码
\fi

\ifTemElegX@font
  \RequirePackage{amssymb, amsfonts}
  % \RequirePackage{unicode-math}
  \setmainfont{Latin Modern Roman}%
  \setsansfont{Latin Modern Sans}%
  \setmonofont{Latin Modern Mono}%
  % \setmathfont{Latin Modern Math}%
  % \setmathfont{XITS Math}[range={scr, bfscr}]%
%
% \setmainfont[%
% ItalicFont=NewCM10-BookItalic.otf,%
% BoldFont=NewCM10-Bold.otf,%
% BoldItalicFont=NewCM10-BoldItalic.otf,%
% SmallCapsFeatures={Numbers=OldStyle}]{NewCM10-Book.otf}
%
% \setsansfont[%
% ItalicFont=NewCMSans10-BookOblique.otf,%
% BoldFont=NewCMSans10-Bold.otf,%
% BoldItalicFont=NewCMSans10-BoldOblique.otf,%
% SmallCapsFeatures={Numbers=OldStyle}]{NewCMSans10-Book.otf}
%
% \setmonofont[ItalicFont=NewCMMono10-BookItalic.otf,%
% BoldFont=NewCMMono10-Bold.otf,%
% BoldItalicFont=NewCMMono10-BoldOblique.otf,%
% SmallCapsFeatures={Numbers=OldStyle}]{NewCMMono10-Book.otf}
%
% \setmathfont{NewCMMath-Book.otf}
%
%  \setmainfont{XITS}
%  \setmathfont{XITS Math}
%  \setmathfont[range=\mathbb]{TeX Gyre Termes Math}
%  \setsansfont{Source Sans 3}
%  \setmonofont{Iosevka Fixed Slab}[ItalicFont=霞鹜文楷等宽 GB Light]
  \setCJKmainfont{思源宋体 Light}[BoldFont=思源宋体 SemiBold, ItalicFont=霞鹜文楷 GB Light]%
  \setCJKsansfont{思源黑体 Light}[BoldFont=思源黑体 Medium]%
  \setCJKmonofont{等距更纱黑体 Slab SC}%
  \newfontfamily\gentium{Gentium Plus}%
  \newfontfamily\genbook{Gentium Book Plus}%
  \newfontfamily\sserif{Source Serif 4}%
  \newfontfamily\ssans{Source Sans 3}%
  \newfontfamily\cascadia{Cascadia Mono}%
  \newfontfamily\sarasa{Sarasa Fixed Slab SC}%
  \newCJKfontfamily\song{思源宋体 Light}[BoldFont=思源宋体 SemiBold]%
  \newCJKfontfamily\xbs{思源宋体 ExtraLight} % 小标宋
  \newCJKfontfamily\bs{思源宋体} % 标宋
  \newCJKfontfamily\das{思源宋体 Medium} % 大宋
  \newCJKfontfamily\cus{思源宋体 Heavy} % 粗宋
  \newCJKfontfamily\hei{思源黑体 Light}[BoldFont=思源黑体 Medium]%
  \newCJKfontfamily\xih{思源黑体 ExtraLight} % 细黑
  \newCJKfontfamily\bh{思源黑体 Normal} % 标黑
  \newCJKfontfamily\dah{思源黑体} % 大黑
  \newCJKfontfamily\cuh{思源黑体 Heavy} % 粗黑
  \newCJKfontfamily\xik{霞鹜文楷 GB Light} % 细楷
  \newCJKfontfamily\kai{霞鹜文楷 GB} % 楷体
  \newCJKfontfamily\cuk{霞鹜文楷 GB Medium} % 粗楷
  \newCJKfontfamily\fzfs{FZFangSong-Z02} % 仿宋  建议不用于PDF中
  \newCJKfontfamily\fzss{FZShuSong-Z01} % 书宋    因为方正此四字体嵌入后
  \newCJKfontfamily\fzkt{FZKai-Z03} % 楷体         商业使用需要得到方正授权
  %思源宋体ExtraLight Light 不填   Medium SemiBold Heavy
  %思源黑体ExtraLight Light Normal 不填   Medium   Heavy
  %霞鹜文楷           Light 不填   Medium
  %\newfontfamily\re{Source Serif 4 Light}[BoldFont=Source Serif 4 SemiBold]
  %\newfontfamily\co{Source Sans 3 Light}[BoldFont=Source Sans 3]
  \newCJKfontfamily\cre{霞鹜文楷 GB Light}[BoldFont=霞鹜文楷 GB Medium] %Chinese reference
  \newCJKfontfamily\cco{思源黑体 Light}[BoldFont=思源黑体] %Chinese concept
  \newcommand{\re}{\textit} %reference
  \newcommand{\co}{\textsf} %concept
\fi

\ifTemElegX@graphicx
  \RequirePackage{graphicx}
  \graphicspath{{}{../Pic/}{../figures/}{../images/}}
  \newcommand{\pic}[1][.8]{\includegraphics[width = #1\textwidth]}
\fi

\ifTemElegX@table
  \RequirePackage{tabu, multirow, colortbl, makecell, booktabs, tabularx, arydshln} %table
  \setlist{nosep}                                                   % 移除列表项之间的间距
\fi

\newcommand{\abs}[1][\ ]{\ensuremath{\left\lvert #1 \right\rvert}}%
\ifTemElegX@math
  \RequirePackage{amsmath, amssymb, amsfonts, amsthm}
  \RequirePackage{dsfont}
  \RequirePackage{fixdif}
  \RequirePackage{unicode-math}
  \setmathfont{Latin Modern Math}%
  \setmathfont{XITS Math}[range={scr, bfscr}]%

  %gb
  \newcommand{\initsim}{\sim}
  \renewcommand{\sim}{\backsim}
  \newcommand{\initcong}{\cong}
  \renewcommand{\cong}{\backcong}
  \newcommand{\leqhorz}{\leq}
  \renewcommand{\leq}{\leqslant}
  \newcommand{\geqhorz}{\geq}
  \renewcommand{\geq}{\geqslant}

  \DeclareMathOperator{\logd}{log}
  \DeclareMathOperator{\lnd}{ln}
  \DeclareMathOperator{\lbd}{lb}
  \DeclareMathOperator{\lgd}{lg}

  \renewcommand{\log}[2][]{\ensuremath{%   logarithm
    \ifx\relax#1\relax%
      \ifx\relax#2\relax%
        \logd%
      \else%
        \logd\left(#2\right)%
      \fi%
    \else%
      \ifx\relax#2\relax%
        \logd_{#1}%
      \else%
        \logd_{#1}\left(#2\right)%
      \fi%
    \fi%
  }}%
  \renewcommand{\ln}[1]{\ensuremath{%      natural logarithm
    \ifx\relax#1\relax%
      \lnd%
    \else%
      \lnd\left(#1\right)%
    \fi%
  }}%
  \renewcommand{\lg}[1]{\ensuremath{%      decimal logarithm
    \ifx\relax#1\relax%
      \lgd%
    \else%
      \lgd\left(#1\right)%
    \fi%
  }}%
  \newcommand{\lb}[1]{\ensuremath{%        binary  logarithm
    \ifx\relax#1\relax%
      \lbd%
    \else%
      \lbd\left(#1\right)%
    \fi%
  }}
%
  \newcommand{\HH}{\ensuremath{\mathbb{H}}}% 四元数
  \newcommand{\CC}{\ensuremath{\mathbb{C}}}%
  \newcommand{\RR}{\ensuremath{\mathbb{R}}}%
  \newcommand{\NN}{\ensuremath{\mathbb{N}}}%
  \newcommand{\QQ}{\ensuremath{\mathbb{Q}}}%
  \newcommand{\ZZ}{\ensuremath{\mathbb{Z}}}%
%
  \newcommand{\dotlessi}{\i}%
  \newcommand{\ii}{\ensuremath{\mathrm{i}}}%
  \newcommand{\dotlessj}{\j}%
  \newcommand{\jj}{\ensuremath{\mathrm{j}}}%
  \newcommand{\mrm}{\mathrm}%
  \newcommand{\ee}{\ensuremath{\mathrm{e}}}%
  \newcommand{\ciratio}{\ensuremath{\symup{\pi}}}%
  \newcommand{\ppi}{\ensuremath{\symup{\pi}}}%
  \newcommand{\diff}{\ensuremath{\d}}
  
  \newcommand{\deriv}[3][1]{%
      \ifnum#1=1%
          \frac{\d #2}{\d #3}%
      \else%
          \frac{\d^{#1} #2}{\d #3^{#1}}%
      \fi%
  }%
  \newcommand{\pderiv}[3][1]{\ensuremath{%
      \ifnum#1=1%
          \frac{\partial #2}{\partial #3}%
      \else%
          \frac{\partial^{#1} #2}{\partial #3^{#1}}%
      \fi%
  }}%
  \newcommand{\mpderiv}[5]{\ensuremath{%
    \ifnum#3=1%
      \ifnum#5=1%
        \frac{\partial^{2} #1}{\partial #2 \partial #4}%
      \else%
        \frac{\partial^{\the\numexpr1+#5} #1}{\partial #2 \partial #4^{#5}}%
      \fi%
    \else%
      \ifnum#5=1%
        \frac{\partial^{\the\numexpr#3+1} #1}{\partial #2 \partial #4^{#5}}%
      \else%
        \frac{\partial^{\the\numexpr#3+#5} #1}{\partial #2^{#3} \partial #4^{#5}}%
    \fi%
  }}%
  \newcommand{\upderiv}[3][1]{\ensuremath{%
      \ifnum#1=1%
          \frac{\symup{\partial} #2}{\symup{\partial} #3}%
      \else%
          \frac{\symup{\partial}^{#1} #2}{\symup{\partial} #3^{#1}}%
      \fi%
  }}%
  \newcommand{\mupderiv}[5]{\ensuremath{%
    \ifnum#3=1%
      \ifnum#5=1%
        \frac{\symup{\partial}^{2} #1}{\symup{\partial} #2 \symup{\partial} #4}%
      \else%
        \frac{\symup{\partial}^{\the\numexpr1+#5} #1}{\symup{\partial} #2 \symup{\partial} #4^{#5}}%
      \fi%
    \else%
      \ifnum#5=1%
        \frac{\symup{\partial}^{\the\numexpr#3+1} #1}{\symup{\partial} #2 \symup{\partial} #4^{#5}}%
      \else%
        \frac{\symup{\partial}^{\the\numexpr#3+#5} #1}{\symup{\partial} #2^{#3} \symup{\partial} #4^{#5}}%
    \fi%
  }}%
  \newcommand{\transpose}[1]{\ensuremath{#1^{\mathrm{T}}}}%
\fi

\ifTemElegX@env
%  \newtheorem{Thm}{Theorem}[section] % 定理
%  \newtheorem{Lem}{Lemma}[section] % 引理
%  \newtheorem{Prop}{Proposition}[section] % 命题
%  \newtheorem{Cor}{Corollary}[section] % 推论
%  \newtheorem{Def}{Definition}[section] % 定义
%  \newtheorem{Rmk}{Remark}[section] % 备注
%  \newtheorem{Hyp}{Hypothesis}[section] % 假设
%  \newtheorem{Tac}{Tactic}[section] % 策略
%  \newtheorem{Calc}{Calculation}[section] % 计算
%  \newtheorem{Alg}{Algorithm}[section] % 算法
%  \newtheorem{E.g.}{Example}[section] % 例子
%  \newtheorem{Ex.}{Exercise}[section] % 练习
%  \newtheorem{Proof}{Proof}[section] % 证明
%  \newtheorem{Think}{Think}[section] % 思考
%  \newtheorem{Quiz}{Quiz}[section] % 提问

  \newtheorem{Theorem}{Theorem}[section] % 定理
  \newtheorem{Lemma}{Lemma}[section] % 引理
  \newtheorem{Axiom}{Axiom}[section] % 公理
  \newtheorem{Hypothesis}{Hypothesis}[section] % 假设
  \newtheorem{Goal}{Goal}[section] % 目标
  \newtheorem{Conjecture}{Conjecture}[section] % 猜想
  \newtheorem{Prop}{Proposition}[section] % 命题
  \newtheorem{Corollary}{Corollary}[section] % 推论
  \newtheorem{Def}{Definition}[section] % 定义
  \newtheorem{Remark}{Remark}[section] % 备注
  \newtheorem{Info}{Infomation}[section] % 信息
  \newtheorem{Note}{Note}[section] % 注释
  \newtheorem{Tactic}{Tactic}[section] % 策略
  \newtheorem{Calc}{Calculation}[section] % 计算
  \newtheorem{Algorithm}{Algorithm}[section] % 算法
  \newtheorem{Example}{Example}[section] % 例子
  \newtheorem{Exercise}{Exercise}[section] % 练习
  \newtheorem{Proof}{Proof}[section] % 证明
  \newtheorem{Think}{Think}[section] % 思考
  \newtheorem{Quiz}{Quiz}[section] % 提问
\fi

\ifTemElegX@chem
  \RequirePackage{chemfig}%
  \RequirePackage{extarrows}%
  \RequirePackage[version = 4]{mhchem}%
\fi

\AtEndPreamble{
  \usepackage[unicode=true]{hyperref} % this should come last of loaded packages, usually %https://tex.stackexchange.com/questions/1863/which-packages-should-be-loaded-after-hyperref-instead-of-before
  \usepackage{bookmark}
  %\usepackage[perpage, hang, ragged, stable, para]{footmisc} % this should come last of hyperref
  \usepackage[perpage, ragged, stable, marginal, hang, multiple]{footmisc} % this should come last of hyperref
  % 使脚注标记不呈现为普通上标
  \renewcommand{\thefootnote}{\Circled{\arabic{footnote}}}
  \renewcommand{\@makefntext}[1]{%
    \noindent\makebox[1.8em][l]{\footnotesize\textnormal{\@thefnmark}}#1%
  }
}